
# ğŸŒ«ï¸ Dehazing ëª¨ë“ˆ ì„¤ëª…

ì´ í´ë”ëŠ” ììœ¨ì£¼í–‰ ì˜ìƒ ì²˜ë¦¬ì—ì„œ ì•ˆê°œ(Haze)ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê±°ë‚˜ ì œê±°(Dehaze)í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ëª¨ë“ˆë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤. ê° ëª¨ë“ˆì€ ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ë˜ëŠ” ì‹¤í—˜ í™˜ê²½ì—ì„œ ë‹¨ë… ë˜ëŠ” ì—°ê³„í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“ êµ¬ì„± íŒŒì¼ ì„¤ëª…

### 1. `haze_filter.py`
- **ê¸°ëŠ¥:** ì´ë¯¸ì§€ ë˜ëŠ” ì˜ìƒ í”„ë ˆì„ì— ì•ˆê°œ íš¨ê³¼ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
- **ì£¼ìš” í•¨ìˆ˜:**
  - `apply_fog_tensor(image_tensor, beta=2.3, A=0.8, layers=100)`
    - ì¤‘ì‹¬ì—ì„œ ë©€ì–´ì§ˆìˆ˜ë¡ íë ¤ì§€ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ì•ˆê°œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    - `beta`: ì•ˆê°œ ë†ë„, `A`: ëŒ€ê¸°ê´‘ ê°•ë„, `layers`: ëˆ„ì  ê¹Šì´ ì¡°ì ˆ
- **ì‚¬ìš© ì˜ˆ:**

```python
from haze_filter import apply_fog_tensor
hazy = apply_fog_tensor(image_tensor, beta=2.3, A=0.8)
```

---

### 2. `dehaze_utils.py`
- **ê¸°ëŠ¥:** í•™ìŠµëœ ë””í—¤ì´ì§• ëª¨ë¸(AOD-Net)ì„ ì´ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›í•©ë‹ˆë‹¤.
- **ì£¼ìš” í•¨ìˆ˜:**
  - `dehaze_image_tensor(model, image_tensor)` â€” í…ì„œ ì…ë ¥ì„ ë””í—¤ì´ì§•í•˜ì—¬ numpyë¡œ ë°˜í™˜
  - `dehaze_image_np(model, rgb_image_np, device)` â€” numpy ì…ë ¥ì„ ë‚´ë¶€ì ìœ¼ë¡œ í…ì„œë¡œ ë³€í™˜ í›„ ì²˜ë¦¬
- **ì‚¬ìš© ì˜ˆ:**

```python
from dehaze_utils import dehaze_image_np
clean_img = dehaze_image_np(model, rgb_img, device)
```

---

### 3. `net.py`
- **ê¸°ëŠ¥:** AOD-Net ëª¨ë¸ êµ¬ì¡° ì •ì˜
- **í´ë˜ìŠ¤:**
  - `dehaze_net`: PyTorch ê¸°ë°˜ ë””í—¤ì´ì§• ëª¨ë¸ êµ¬ì¡°
- **ì‚¬ìš© ì˜ˆ:**

```python
from net import dehaze_net
model = dehaze_net().to(device)
```

---

### 4. `roi_utils.py`
- **ê¸°ëŠ¥:** ì¤‘ì‹¬ ROI(Region of Interest) ì˜ì—­ì— ëŒ€í•´ ì¬ë””í—¤ì´ì§• ì²˜ë¦¬ ë° ë¸”ë Œë”© ì§€ì›
- **ì£¼ìš” í•¨ìˆ˜:**
  - `create_alpha_mask(h, w)`: ì¤‘ì‹¬ì´ ì§„í•˜ê³  ì™¸ê³½ì´ ì—°í•œ ì›í˜• ì•ŒíŒŒ ë§ˆìŠ¤í¬ ìƒì„±
  - `apply_roi_blend(base_image, roi_image, x1, y1, alpha_mask)`: base ì´ë¯¸ì§€ì˜ ì§€ì • ì˜ì—­ì— ROIë¥¼ ë¶€ë“œëŸ½ê²Œ í•©ì„±
- **ì‚¬ìš© ì˜ˆ:**

```python
from roi_utils import create_alpha_mask, apply_roi_blend
alpha = create_alpha_mask(roi_h, roi_w)
blended = apply_roi_blend(base_img, roi_img, x1, y1, alpha)
```

---

### 5. `hazing_and_dehazing.py`
- **ê¸°ëŠ¥:** ì „ì²´ í”„ë ˆì„ íŒŒì´í”„ë¼ì¸ (ì•ˆê°œ ìƒì„± â†’ ë””í—¤ì´ì§• â†’ ROI ì¬ì²˜ë¦¬ â†’ ì €ì¥)
- **ì§€ì› ì¸ì:**
  - `--enable_haze`: ì•ˆê°œ ì ìš© ì—¬ë¶€
  - `--enable_aod`: ì „ì²´ í”„ë ˆì„ ë””í—¤ì´ì§• ì—¬ë¶€
  - `--enable_roi`: ì¤‘ì•™ ì˜ì—­ ì¬ë””í—¤ì´ì§• ì—¬ë¶€
  - `--enable_blend`: ROIë¥¼ ë¶€ë“œëŸ½ê²Œ ë¸”ë Œë”©í• ì§€ ì—¬ë¶€
  - `--haze_beta`, `--haze_A`, `--haze_layers`: ì•ˆê°œ ê°•ë„ ì¡°ì ˆ
- **ì‚¬ìš© ì˜ˆ:**

```bash
python hazing_and_dehazing.py \
  --enable_haze --enable_aod --enable_roi --enable_blend \
  --haze_beta 2.3 --haze_A 0.8 --haze_layers 100 \
  --output_suffix blended_test
```

---

### 6. `test_run.py`
- **ê¸°ëŠ¥:** `dehaze_net` ëª¨ë¸ í…ŒìŠ¤íŠ¸, hazing í•¨ìˆ˜ ë‹¨ìœ„ í™•ì¸ ë“±ì„ ìœ„í•œ ì‹¤í—˜ìš© ìŠ¤í¬ë¦½íŠ¸
- **ë¹„ê³ :** í”„ë ˆì„ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë‚˜ ì‹œê°í™” ë””ë²„ê¹… ìš©ë„ë¡œ ììœ ë¡­ê²Œ ìˆ˜ì •í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥

---

## ğŸ“¦ ê¸°íƒ€ íŒŒì¼

| íŒŒì¼ëª…           | ì„¤ëª…                                       |
|------------------|--------------------------------------------|
| `dehazer.pth`    | í•™ìŠµëœ AOD-Net PyTorch ëª¨ë¸ ê°€ì¤‘ì¹˜ íŒŒì¼     |
| `final_output.mp4` | ë””í—¤ì´ì§• ë° ê°ì²´ ì¸ì‹ ê²°ê³¼ ë¹„ë””ì˜¤ ì˜ˆì‹œ ì¶œë ¥ íŒŒì¼ |

---

## ğŸ§ª ì‹¤í–‰ íë¦„ ìš”ì•½

```text
[ì›ë³¸ í”„ë ˆì„]
    â†“
[ì•ˆê°œ ì ìš© (ì„ íƒ)]
    â†“
[ì „ì²´ ë””í—¤ì´ì§• (ì„ íƒ)]
    â†“
[ROI ì¬ë””í—¤ì´ì§• ë° ë¸”ë Œë”© (ì„ íƒ)]
    â†“
[ì˜ìƒ ì €ì¥]
```

---

## ğŸ”— ì—°ê³„ ì‚¬ìš©

- ì´ ëª¨ë“ˆì€ `processing/hazing_yolo_pipeline.py`ì— ì—°ê³„í•˜ì—¬ ì‚¬ìš©ë©ë‹ˆë‹¤.
- Jetson ê¸°ë°˜ ì‹¤ì‹œê°„ ì˜ìƒ ì²˜ë¦¬ë‚˜ ììœ¨ì£¼í–‰ ì¸ì‹ ì‹¤í—˜ì— í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
